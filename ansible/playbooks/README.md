# Ansible Playbooks

This directory contains Ansible playbooks used by the Homelab Manager for device provisioning and management.

## Available Playbooks

### ping.yml
Simple connectivity test playbook that:
- Pings the device to verify SSH connectivity
- Gathers system facts
- Displays device uptime

**Use case**: Verify basic connectivity and SSH access to a device.

### system_info.yml
Gathers and displays comprehensive system information:
- OS distribution and version
- CPU information (cores, model)
- Memory information (total RAM)
- Disk information (mounts and sizes)
- Network interfaces

**Use case**: Quick system inventory and health check.

### update.yml
System update playbook for Debian/Ubuntu systems:
- Updates apt package cache
- Performs dist-upgrade
- Removes unused packages (autoremove)
- Cleans package cache (autoclean)

**Use case**: Regular system maintenance and security updates.

**Note**: Requires `become: yes` (sudo privileges).

### docker_install.yml
Installs Docker on Debian/Ubuntu systems:
- Installs required dependencies
- Adds Docker GPG key and repository
- Installs Docker CE and containerd
- Starts and enables Docker service
- Verifies installation

**Use case**: Prepare a device for containerized workloads.

**Note**: Requires `become: yes` (sudo privileges).

## Playbook Structure

All playbooks use the `homelab` inventory group, which is dynamically generated by the AnsibleExecutor service based on the target device.

## Creating Custom Playbooks

To add a new playbook:

1. Create a `.yml` file in this directory
2. Use the `homelab` host group
3. Follow Ansible best practices
4. The playbook will be automatically available in the frontend

Example:
```yaml
---
- name: My custom playbook
  hosts: homelab
  gather_facts: yes

  tasks:
    - name: My task
      # your task here
```

## SSH Requirements

All playbooks assume:
- SSH access to devices via root user
- SSH keys configured (no password prompts)
- StrictHostKeyChecking disabled (configured in dynamic inventory)
- Python 3 available on target devices

## Execution

Playbooks are executed via the Homelab Manager API:
```
POST /api/provisioning
{
  "device_id": 1,
  "playbook_name": "ping"
}
```

The system will:
1. Create a ProvisioningJob in the database
2. Generate a dynamic Ansible inventory for the target device
3. Execute the playbook in a background thread
4. Capture all output logs
5. Update job status (pending → running → completed/failed)
